<svg viewBox="0 0 800 500" xmlns="http://www.w3.org/2000/svg">
    <style>
        text { font-family: Inter, 'Segoe UI', sans-serif; }
    </style>
    
    <!-- Title -->
    <text x="400" y="30" text-anchor="middle" font-size="18" font-weight="600" fill="#667eea">
        Theme Token Flow
    </text>
    <text x="400" y="48" text-anchor="middle" font-size="11" fill="#94a3b8">
        How theme values propagate from definition to DOM
    </text>
    
    <!-- Layer 1: Theme Definition -->
    <rect x="50" y="70" width="180" height="100" rx="8" fill="#1e293b" stroke="#334155" stroke-width="1"/>
    <text x="140" y="90" text-anchor="middle" font-size="12" font-weight="600" fill="#667eea">Theme Definition</text>
    <text x="140" y="108" text-anchor="middle" font-size="9" fill="#94a3b8">themes/win32-classic.js</text>
    <text x="65" y="128" font-size="9" fill="#22c55e" font-family="monospace">color_bg: '#ECE9D8'</text>
    <text x="65" y="142" font-size="9" fill="#22c55e" font-family="monospace">radius_1: '0px'</text>
    <text x="65" y="156" font-size="9" fill="#22c55e" font-family="monospace">font_size: '11px'</text>
    
    <!-- Arrow 1→2 -->
    <line x1="230" y1="120" x2="280" y2="120" stroke="#667eea" stroke-width="2" marker-end="url(#arrowhead)"/>
    <defs>
        <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto">
            <polygon points="0 0, 10 3.5, 0 7" fill="#667eea"/>
        </marker>
    </defs>
    
    <!-- Layer 2: Variant Registry -->
    <rect x="290" y="70" width="180" height="100" rx="8" fill="#1e293b" stroke="#334155" stroke-width="1"/>
    <text x="380" y="90" text-anchor="middle" font-size="12" font-weight="600" fill="#f59e0b">Variant Registry</text>
    <text x="380" y="108" text-anchor="middle" font-size="9" fill="#94a3b8">themes/variants.js</text>
    <text x="305" y="128" font-size="9" fill="#f59e0b" font-family="monospace">button['vs-classic']</text>
    <text x="305" y="142" font-size="9" fill="#94a3b8" font-family="monospace">  shape: 'square'</text>
    <text x="305" y="156" font-size="9" fill="#94a3b8" font-family="monospace">  border: 'beveled'</text>
    
    <!-- Arrow 2→3 -->
    <line x1="470" y1="120" x2="520" y2="120" stroke="#667eea" stroke-width="2" marker-end="url(#arrowhead)"/>
    
    <!-- Layer 3: Themeable Mixin -->
    <rect x="530" y="70" width="220" height="100" rx="8" fill="#1e293b" stroke="#334155" stroke-width="1"/>
    <text x="640" y="90" text-anchor="middle" font-size="12" font-weight="600" fill="#ef4444">themeable() Mixin</text>
    <text x="640" y="108" text-anchor="middle" font-size="9" fill="#94a3b8">control_mixins/themeable.js</text>
    <text x="545" y="128" font-size="9" fill="#ef4444" font-family="monospace">resolve_params()</text>
    <text x="545" y="142" font-size="9" fill="#94a3b8" font-family="monospace">merge(variant, ctx, spec)</text>
    <text x="545" y="156" font-size="9" fill="#94a3b8" font-family="monospace">→ final params object</text>
    
    <!-- Merge priority callout -->
    <rect x="50" y="200" width="700" height="60" rx="6" fill="#0f172a" stroke="#667eea" stroke-width="1" stroke-dasharray="4"/>
    <text x="400" y="220" text-anchor="middle" font-size="12" font-weight="600" fill="#667eea">Merge Priority (lowest → highest)</text>
    <text x="150" y="245" text-anchor="middle" font-size="11" fill="#94a3b8">① Variant defaults</text>
    <text x="400" y="245" text-anchor="middle" font-size="11" fill="#94a3b8">② Context theme params</text>
    <text x="620" y="245" text-anchor="middle" font-size="11" fill="#f1f5f9">③ Instance spec params</text>
    <text x="150" y="245" text-anchor="middle" font-size="11" fill="#94a3b8">① Variant defaults</text>
    <!-- Priority arrows -->
    <line x1="250" y1="240" x2="300" y2="240" stroke="#667eea" stroke-width="1.5" marker-end="url(#arrowhead)"/>
    <line x1="500" y1="240" x2="530" y2="240" stroke="#667eea" stroke-width="1.5" marker-end="url(#arrowhead)"/>
    
    <!-- Arrow down to control -->
    <line x1="640" y1="170" x2="640" y2="290" stroke="#667eea" stroke-width="2" marker-end="url(#arrowhead)"/>
    
    <!-- Layer 4: Control Instance -->
    <rect x="530" y="300" width="220" height="80" rx="8" fill="#1e293b" stroke="#334155" stroke-width="1"/>
    <text x="640" y="320" text-anchor="middle" font-size="12" font-weight="600" fill="#22c55e">Control Instance</text>
    <text x="640" y="338" text-anchor="middle" font-size="9" fill="#94a3b8">const btn = new Button(spec)</text>
    <text x="545" y="358" font-size="9" fill="#22c55e" font-family="monospace">data-variant="vs-classic"</text>
    <text x="545" y="372" font-size="9" fill="#22c55e" font-family="monospace">data-theme="win32"</text>
    
    <!-- Arrow down to DOM -->
    <line x1="640" y1="380" x2="640" y2="405" stroke="#667eea" stroke-width="2" marker-end="url(#arrowhead)"/>
    
    <!-- Layer 5: DOM Output -->
    <rect x="430" y="415" width="340" height="70" rx="8" fill="#0f172a" stroke="#22c55e" stroke-width="2"/>
    <text x="600" y="435" text-anchor="middle" font-size="12" font-weight="600" fill="#22c55e">DOM (Browser)</text>
    <text x="445" y="455" font-size="9" fill="#f1f5f9" font-family="monospace">&lt;button data-theme="win32"</text>
    <text x="445" y="469" font-size="9" fill="#f1f5f9" font-family="monospace">  style="--theme-color-bg:#ECE9D8;..."&gt;</text>
    
    <!-- CSS Variables callout -->
    <rect x="50" y="300" width="200" height="80" rx="6" fill="#1e293b" stroke="#334155" stroke-width="1"/>
    <text x="150" y="320" text-anchor="middle" font-size="11" font-weight="600" fill="#3b82f6">CSS Selectors Match</text>
    <text x="60" y="340" font-size="9" fill="#3b82f6" font-family="monospace">[data-theme="win32"]</text>
    <text x="60" y="355" font-size="9" fill="#3b82f6" font-family="monospace">[data-variant="vs-classic"]</text>
    <text x="60" y="370" font-size="9" fill="#94a3b8" font-family="monospace">→ applies CSS rules</text>
    
    <!-- Arrow from CSS to DOM -->
    <line x1="250" y1="365" x2="430" y2="445" stroke="#3b82f6" stroke-width="1.5" stroke-dasharray="4" marker-end="url(#arrowhead)"/>
    
    <!-- Footer -->
    <text x="400" y="498" text-anchor="middle" font-size="10" fill="#64748b">
        jsgui3-html Control Design Book — Chapter 3 Reference
    </text>
</svg>
